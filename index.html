<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ูุฑู ุงุทูุงุนุงุช ูพุฑุณูู</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { font-family: Vazirmatn, Tahoma, sans-serif; }
    body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
    .page { display: none !important; }
    .page.active { display: block !important; }
    
    .main-page { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
    .main-container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 40px; max-width: 500px; width: 100%; text-align: center; }
    .main-container h1 { color: #667eea; font-size: 32px; margin-bottom: 30px; }
    .btn-panel { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 18px; margin-bottom: 15px; color: white; transition: all 0.3s; }
    .btn-panel:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .btn-admin { background: #667eea; }
    .btn-teacher { background: #48bb78; }
    
    .password-page { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
    .password-container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 40px; max-width: 400px; width: 100%; text-align: center; }
    .password-container h1 { color: #667eea; font-size: 28px; margin-bottom: 30px; }
    .password-input-wrapper input { width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 16px; margin-bottom: 20px; }
    .password-input-wrapper input:focus { outline: none; border-color: #667eea; }
    .btn-password { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; background: #667eea; color: white; margin-bottom: 10px; }
    .btn-back { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; background: #718096; color: white; }
    
    .search-page { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
    .search-container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 40px; max-width: 600px; width: 100%; }
    .search-container h1 { color: #667eea; font-size: 28px; text-align: center; margin-bottom: 20px; }
    .search-input-wrapper input { width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 16px; margin-bottom: 20px; }
    .search-input-wrapper input:focus { outline: none; border-color: #667eea; }
    .search-results { max-height: 300px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 10px; margin-bottom: 20px; }
    .search-result-item { padding: 15px; border-bottom: 1px solid #e0e0e0; cursor: pointer; }
    .search-result-item:hover { background: #f0f3ff; }
    .btn-group-search { display: flex; gap: 10px; }
    .btn-group-search button { flex: 1; padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; color: white; }
    .btn-search { background: #667eea; }
    .btn-new { background: #48bb78; }
    
    .form-page { padding: 30px 20px; }
    .form-container { background: white; border-radius: 15px; padding: 30px; max-width: 1000px; margin: 0 auto; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .form-header { border-bottom: 2px solid #f0f0f0; padding-bottom: 20px; margin-bottom: 25px; }
    .form-title { color: #667eea; font-size: 24px; font-weight: 700; margin: 0; }
    .form-counter { background: #667eea; color: white; padding: 8px 16px; border-radius: 15px; font-size: 13px; display: inline-block; }
    .card-section { background: #f5f7ff; border: 1px solid #e0e7ff; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
    .section-title { color: #667eea; font-weight: 700; margin-bottom: 15px; font-size: 15px; }
    .form-group-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 15px; }
    .form-label { color: #333; font-weight: 600; margin-bottom: 6px; font-size: 13px; }
    .form-control, .form-select { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 13px; width: 100%; }
    .form-control:focus, .form-select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
    textarea.form-control { min-height: 70px; resize: vertical; }
    .buttons-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 12px; margin-top: 30px; }
    .btn-custom { padding: 12px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 13px; color: white; transition: all 0.2s; }
    .btn-save { background: #48bb78; }
    .btn-edit { background: #4299e1; }
    .btn-delete { background: #f56565; }
    .btn-print { background: #667eea; }
    
    @media print {
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { 
        background: white; 
        font-size: 10px; 
        line-height: 1.2; 
        font-family: Vazirmatn, Tahoma, sans-serif;
      }
      .page { display: block !important; }
      .form-page { padding: 5px !important; }
      .form-container { 
        box-shadow: none; 
        border-radius: 0; 
        padding: 8px !important; 
        max-width: 100%;
        border: 1px solid #000;
      }
      .form-header { display: none; }
      
      /* ูุฏุฑ ุฌุฏุฏ ุจุฑุง ฺุงูพ */
      .print-header {
        text-align: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #000;
      }
      .print-header h1 {
        font-size: 16px;
        font-weight: bold;
        margin: 0;
      }
      .print-header h2 {
        font-size: 14px;
        margin: 5px 0 0 0;
        color: #333;
      }
      
      .card-section { 
        background: white !important;
        border: none !important;
        padding: 0 !important;
        margin-bottom: 0 !important;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0;
      }
      .section-title { 
        display: block !important;
        grid-column: 1 / -1;
        background: #f0f0f0;
        padding: 5px 8px;
        margin-bottom: 5px;
        font-size: 11px;
        font-weight: bold;
        border-bottom: 1px solid #ccc;
      }
      .form-group-row { 
        display: contents;
      }
      .form-group-row > div {
        display: grid;
        grid-template-columns: 1fr 1fr;
        border: 0.5px solid #000;
        padding: 4px;
        page-break-inside: avoid;
      }
      .form-group-row > div:nth-child(odd) {
        grid-column: 1;
      }
      .form-group-row > div:nth-child(even) {
        grid-column: 2;
      }
      .form-label { 
        font-size: 9px;
        font-weight: 600;
        text-align: right;
        padding-right: 5px;
      }
      .form-control, .form-select, textarea { 
        padding: 2px 3px !important;
        font-size: 9px !important;
        border: none !important;
        height: auto !important;
        min-height: 20px !important;
        text-align: right;
      }
      textarea { min-height: 25px !important; }
      .buttons-group { display: none !important; }
      
      /* ุจุฎุด ุงูุถุง ุชุงุฏฺฉููุฏู */
      .approval-section {
        margin-top: 20px;
        padding-top: 10px;
        border-top: 1px solid #000;
        text-align: left;
      }
      .approval-line {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
      }
      .approval-space {
        width: 200px;
        border-bottom: 1px solid #000;
        text-align: center;
        padding-bottom: 5px;
      }
      
      @page {
        size: A4;
        margin: 5mm;
      }
    }
    @media (max-width: 768px) {
      .form-group-row { grid-template-columns: 1fr; }
      .buttons-group { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <!-- ุตูุญู ุงุตู -->
  <div id="mainPage" class="page active main-page">
    <div class="main-container">
      <h1>๐ ุณุณุชู ุงุทูุงุนุงุช ูพุฑุณูู</h1>
      <button class="btn-panel btn-admin" onclick="showAdminPanel()">๐ ูพูู ูุฏุฑ</button>
      <button class="btn-panel btn-teacher" onclick="showTeacherPanel()">๐จโ๐ซ ูพูู ูุนูู</button>
    </div>
  </div>

  <!-- ุตูุญู ุฑูุฒ ุนุจูุฑ -->
  <div id="passwordPage" class="page password-page">
    <div class="password-container">
      <h1>๐ ูพูู ูุฏุฑ</h1>
      <div class="password-input-wrapper">
        <input type="password" id="passwordInput" placeholder="ุฑูุฒ ุนุจูุฑ">
      </div>
      <button class="btn-password" onclick="checkPassword()">ูุฑูุฏ</button>
      <button class="btn-back" onclick="backToMain()">ุจุงุฒฺฏุดุช</button>
    </div>
  </div>

  <!-- ุตูุญู ุฌุณุชุฌู -->
  <div id="searchPage" class="page search-page">
    <div class="search-container">
      <h1>๐ ุฌุณุชุฌู</h1>
      <div class="search-input-wrapper">
        <input type="text" id="searchInput" placeholder="ูุงู ุง ฺฉุฏ ูพุฑุณูู...">
      </div>
      <div id="searchResults" class="search-results" style="display: none;"></div>
      <div class="btn-group-search">
        <button class="btn-search" onclick="performSearch()">ุฌุณุชุฌู</button>
        <button class="btn-new" onclick="newRecord()">ุซุจุช ุฌุฏุฏ</button>
        <button class="btn-back" onclick="backToPasswordPage()">ุจุงุฒฺฏุดุช</button>
      </div>
    </div>
  </div>

  <!-- ุตูุญู ูุฑู ูุนูู -->
  <div id="teacherFormPage" class="page form-page">
    <div class="form-container">
      <div class="form-header">
        <h2 class="form-title">ูุฑู ุงุทูุงุนุงุช ูพุฑุณูู</h2>
      </div>
      <form id="teacherForm" onsubmit="submitTeacherForm(event)">
        <!-- ูุดุฎุตุงุช ููุช -->
        <div class="card-section">
          <div class="section-title">๐ค ูุดุฎุตุงุช ููุช</div>
          <div class="form-group-row">
            <div><label class="form-label">ูุงู</label><input type="text" class="form-control" name="firstName" required></div>
            <div><label class="form-label">ูุงู ุฎุงููุงุฏฺฏ</label><input type="text" class="form-control" name="lastName" required></div>
            <div><label class="form-label">ฺฉุฏ ูพุฑุณูู</label><input type="text" class="form-control" name="personnelCode" required></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ฺฉุฏ ูู</label><input type="text" class="form-control" name="nationalId" required></div>
            <div><label class="form-label">ุฌูุณุช</label><select class="form-select" name="gender" required><option>ุงูุชุฎุงุจ</option><option>ูุฑุฏ</option><option>ุฒู</option></select></div>
            <div><label class="form-label">ูุงู ูพุฏุฑ</label><input type="text" class="form-control" name="fatherName"></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ูุญู ุตุฏูุฑ</label><input type="text" class="form-control" name="issuePlace"></div>
            <div><label class="form-label">ูุญู ุชููุฏ</label><input type="text" class="form-control" name="birthPlace"></div>
            <div><label class="form-label">ุชุงุฑุฎ ุชููุฏ</label><input type="text" class="form-control" name="birthDate" placeholder="1404/08/20"></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ูุถุนุช ุชุฃูู</label><select class="form-select" name="maritalStatus"><option></option><option>ูุฌุฑุฏ</option><option>ูุชุฃูู</option></select></div>
            <div><label class="form-label">ุชุนุฏุงุฏ ูุฑุฒูุฏุงู</label><input type="number" class="form-control" name="childrenCount" min="0"></div>
          </div>
        </div>

        <!-- ูุดุฎุตุงุช ุดุบู -->
        <div class="card-section">
          <div class="section-title">๐ผ ูุดุฎุตุงุช ุดุบู</div>
          <div class="form-group-row">
            <div><label class="form-label">ุณูุช</label><select class="form-select" name="position"><option></option><option>ูุฏุฑ</option><option>ุขููุฒฺฏุงุฑ</option><option>ูุนุงูู ุขููุฒุด</option><option>ูุนุงูู ุงุฌุฑุง</option><option>ูุนุงูู ูพุฑูุฑุด</option><option>ูุฑุจ ูพุฑูุฑุด</option><option>ูุฑุจ ูุฑุฒุด</option><option>ูุฑุจ ุจูุฏุงุดุช</option><option>ุฎุฏูุชฺฏุฐุงุฑ</option><option>ุณุฑุงุฏุงุฑ</option><option>ุณุงุฑ</option></select></div>
            <div><label class="form-label">ููุน ุงุณุชุฎุฏุงู</label><select class="form-select" name="employmentType"><option></option><option>ุฑุณู</option><option>ุฑุณู ูพูุงู</option><option>ูุฑุงุฑุฏุงุฏ</option><option>ุณุงุฑ</option></select></div>
            <div><label class="form-label">ูุฏุฑฺฉ ุชุญุตู</label><select class="form-select" name="degree"><option></option><option>ุงุจุชุฏุง</option><option>ุณฺฉู</option><option>ุฏูพูู</option><option>ููู ุฏูพูู</option><option>ูุณุงูุณ</option><option>ููู ูุณุงูุณ</option><option>ุฏฺฉุชุฑุง</option><option>ุณุงุฑ</option></select></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ุฑุดุชู ุชุญุตู</label><input type="text" class="form-control" name="major"></div>
            <div><label class="form-label">ุณุงุจูู (ุณุงู)</label><input type="number" class="form-control" name="experienceYears" min="0"></div>
            <div><label class="form-label">ููุน ุงุดุชุบุงู</label><select class="form-select" name="dutyType"><option></option><option>ููุธู</option><option>ุบุฑ ููุธู</option><option>ุณุงุฑ</option></select></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ูพุงู</label><select class="form-select" name="grade"><option></option><option>ุงูู</option><option>ุฏูู</option><option>ุณูู</option><option>ฺูุงุฑู</option><option>ูพูุฌู</option><option>ุดุดู</option></select></div>
            <div><label class="form-label">ุดูุงุฑู ฺฉูุงุณ</label><select class="form-select" name="classNumber"><option></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select></div>
            <div><label class="form-label">ุฑุงุจุท</label><input type="text" class="form-control" name="liaison"></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ุดูุงุฑู ุญุณุงุจ ุญููู</label><input type="text" class="form-control" name="salaryAccount"></div>
            <div><label class="form-label">ููุน ุจูู</label><select class="form-select" name="insuranceType"><option></option><option>ุชุฃูู ุงุฌุชูุงุน</option><option>ุฎุฏูุงุช ุฏุฑูุงู</option><option>ุจูู ุณูุงูุช</option></select></div>
          </div>
        </div>

        <!-- ุงุทูุงุนุงุช ุฎุงููุงุฏฺฏ -->
        <div class="card-section">
          <div class="section-title">๐จโ๐ฉโ๐ง ุงุทูุงุนุงุช ุฎุงููุงุฏฺฏ</div>
          <div class="form-group-row">
            <div><label class="form-label">ูุงู ู ูุงู ุฎุงููุงุฏฺฏ ููุณุฑ</label><input type="text" class="form-control" name="spouseName"></div>
            <div><label class="form-label">ุดุบู ููุณุฑ</label><input type="text" class="form-control" name="spouseJob"></div>
          </div>
        </div>

        <!-- ุชุงุฏ ู ุงูุถุง -->
        <div class="card-section">
          <div class="section-title">โ ุชุงุฏ ู ุงูุถุง</div>
          <div class="form-group-row">
            <div><label class="form-label">ูุงู ุชุงุฏฺฉููุฏู</label><input type="text" class="form-control" name="approverName"></div>
            <div><label class="form-label">ุชุงุฑุฎ ุชุงุฏ</label><input type="text" class="form-control" name="approveDate" placeholder="1404/08/20"></div>
          </div>
        </div>

        <!-- ุงุทูุงุนุงุช ุชูุงุณ -->
        <div class="card-section">
          <div class="section-title">๐ ุงุทูุงุนุงุช ุชูุงุณ</div>
          <div class="form-group-row">
            <div><label class="form-label">ุดูุงุฑู ููุฑุงู</label><input type="tel" class="form-control" name="mobile"></div>
            <div><label class="form-label">ุดูุงุฑู ุชููู</label><input type="tel" class="form-control" name="phone"></div>
            <div><label class="form-label">ฺฉุฏ ูพุณุช</label><input type="text" class="form-control" name="postalCode"></div>
          </div>
          <div class="form-group-row">
            <div style="grid-column: 1/-1;"><label class="form-label">ุขุฏุฑุณ</label><textarea class="form-control" name="address"></textarea></div>
          </div>
        </div>

        <div class="buttons-group">
          <button type="submit" class="btn-custom btn-save">๐พ ุซุจุช</button>
          <button type="button" class="btn-custom btn-print" onclick="printForm()">๐จ๏ธ ฺุงูพ</button>
          <button type="button" class="btn-custom btn-delete" onclick="backToMain()">โฌ๏ธ ุจุงุฒฺฏุดุช</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ุตูุญู ูุฑู ูุฏุฑ -->
  <div id="adminFormPage" class="page form-page">
    <div class="form-container">
      <div class="form-header">
        <h2 class="form-title">ูุฑู ุงุทูุงุนุงุช ูพุฑุณูู</h2>
        <span class="form-counter"><span id="recordCounter">โ</span></span>
      </div>
      <form id="adminForm" onsubmit="submitAdminForm(event)">
        <!-- ูุดุฎุตุงุช ููุช -->
        <div class="card-section">
          <div class="section-title">๐ค ูุดุฎุตุงุช ููุช</div>
          <div class="form-group-row">
            <div><label class="form-label">ูุงู</label><input type="text" class="form-control" name="firstName" required></div>
            <div><label class="form-label">ูุงู ุฎุงููุงุฏฺฏ</label><input type="text" class="form-control" name="lastName" required></div>
            <div><label class="form-label">ฺฉุฏ ูพุฑุณูู</label><input type="text" class="form-control" name="personnelCode" required></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ฺฉุฏ ูู</label><input type="text" class="form-control" name="nationalId" required></div>
            <div><label class="form-label">ุฌูุณุช</label><select class="form-select" name="gender" required><option>ุงูุชุฎุงุจ</option><option>ูุฑุฏ</option><option>ุฒู</option></select></div>
            <div><label class="form-label">ูุงู ูพุฏุฑ</label><input type="text" class="form-control" name="fatherName"></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ูุญู ุตุฏูุฑ</label><input type="text" class="form-control" name="issuePlace"></div>
            <div><label class="form-label">ูุญู ุชููุฏ</label><input type="text" class="form-control" name="birthPlace"></div>
            <div><label class="form-label">ุชุงุฑุฎ ุชููุฏ</label><input type="text" class="form-control" name="birthDate" placeholder="1404/08/20"></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ูุถุนุช ุชุฃูู</label><select class="form-select" name="maritalStatus"><option></option><option>ูุฌุฑุฏ</option><option>ูุชุฃูู</option></select></div>
            <div><label class="form-label">ุชุนุฏุงุฏ ูุฑุฒูุฏุงู</label><input type="number" class="form-control" name="childrenCount" min="0"></div>
          </div>
        </div>

        <!-- ูุดุฎุตุงุช ุดุบู -->
        <div class="card-section">
          <div class="section-title">๐ผ ูุดุฎุตุงุช ุดุบู</div>
          <div class="form-group-row">
            <div><label class="form-label">ุณูุช</label><select class="form-select" name="position"><option></option><option>ูุฏุฑ</option><option>ุขููุฒฺฏุงุฑ</option><option>ูุนุงูู ุขููุฒุด</option><option>ูุนุงูู ุงุฌุฑุง</option><option>ูุนุงูู ูพุฑูุฑุด</option><option>ูุฑุจ ูพุฑูุฑุด</option><option>ูุฑุจ ูุฑุฒุด</option><option>ูุฑุจ ุจูุฏุงุดุช</option><option>ุฎุฏูุชฺฏุฐุงุฑ</option><option>ุณุฑุงุฏุงุฑ</option><option>ุณุงุฑ</option></select></div>
            <div><label class="form-label">ููุน ุงุณุชุฎุฏุงู</label><select class="form-select" name="employmentType"><option></option><option>ุฑุณู</option><option>ุฑุณู ูพูุงู</option><option>ูุฑุงุฑุฏุงุฏ</option><option>ุณุงุฑ</option></select></div>
            <div><label class="form-label">ูุฏุฑฺฉ ุชุญุตู</label><select class="form-select" name="degree"><option></option><option>ุงุจุชุฏุง</option><option>ุณฺฉู</option><option>ุฏูพูู</option><option>ููู ุฏูพูู</option><option>ูุณุงูุณ</option><option>ููู ูุณุงูุณ</option><option>ุฏฺฉุชุฑุง</option><option>ุณุงุฑ</option></select></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ุฑุดุชู ุชุญุตู</label><input type="text" class="form-control" name="major"></div>
            <div><label class="form-label">ุณุงุจูู (ุณุงู)</label><input type="number" class="form-control" name="experienceYears" min="0"></div>
            <div><label class="form-label">ููุน ุงุดุชุบุงู</label><select class="form-select" name="dutyType"><option></option><option>ููุธู</option><option>ุบุฑ ููุธู</option><option>ุณุงุฑ</option></select></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ูพุงู</label><select class="form-select" name="grade"><option></option><option>ุงูู</option><option>ุฏูู</option><option>ุณูู</option><option>ฺูุงุฑู</option><option>ูพูุฌู</option><option>ุดุดู</option></select></div>
            <div><label class="form-label">ุดูุงุฑู ฺฉูุงุณ</label><select class="form-select" name="classNumber"><option></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select></div>
            <div><label class="form-label">ุฑุงุจุท</label><input type="text" class="form-control" name="liaison"></div>
          </div>
          <div class="form-group-row">
            <div><label class="form-label">ุดูุงุฑู ุญุณุงุจ ุญููู</label><input type="text" class="form-control" name="salaryAccount"></div>
            <div><label class="form-label">ููุน ุจูู</label><select class="form-select" name="insuranceType"><option></option><option>ุชุฃูู ุงุฌุชูุงุน</option><option>ุฎุฏูุงุช ุฏุฑูุงู</option><option>ุจูู ุณูุงูุช</option></select></div>
          </div>
        </div>

        <!-- ุงุทูุงุนุงุช ุฎุงููุงุฏฺฏ -->
        <div class="card-section">
          <div class="section-title">๐จโ๐ฉโ๐ง ุงุทูุงุนุงุช ุฎุงููุงุฏฺฏ</div>
          <div class="form-group-row">
            <div><label class="form-label">ูุงู ู ูุงู ุฎุงููุงุฏฺฏ ููุณุฑ</label><input type="text" class="form-control" name="spouseName"></div>
            <div><label class="form-label">ุดุบู ููุณุฑ</label><input type="text" class="form-control" name="spouseJob"></div>
          </div>
        </div>

        <!-- ุชุงุฏ ู ุงูุถุง -->
        <div class="card-section">
          <div class="section-title">โ ุชุงุฏ ู ุงูุถุง</div>
          <div class="form-group-row">
            <div><label class="form-label">ูุงู ุชุงุฏฺฉููุฏู</label><input type="text" class="form-control" name="approverName"></div>
            <div><label class="form-label">ุชุงุฑุฎ ุชุงุฏ</label><input type="text" class="form-control" name="approveDate" placeholder="1404/08/20"></div>
          </div>
        </div>

        <!-- ุงุทูุงุนุงุช ุชูุงุณ -->
        <div class="card-section">
          <div class="section-title">๐ ุงุทูุงุนุงุช ุชูุงุณ</div>
          <div class="form-group-row">
            <div><label class="form-label">ุดูุงุฑู ููุฑุงู</label><input type="tel" class="form-control" name="mobile"></div>
            <div><label class="form-label">ุดูุงุฑู ุชููู</label><input type="tel" class="form-control" name="phone"></div>
            <div><label class="form-label">ฺฉุฏ ูพุณุช</label><input type="text" class="form-control" name="postalCode"></div>
          </div>
          <div class="form-group-row">
            <div style="grid-column: 1/-1;"><label class="form-label">ุขุฏุฑุณ</label><textarea class="form-control" name="address"></textarea></div>
          </div>
        </div>

        <div class="buttons-group">
          <button type="submit" class="btn-custom btn-save">๐พ ุฐุฎุฑู</button>
          <button type="button" class="btn-custom btn-edit" onclick="editRecord()">โ๏ธ ูุฑุงุด</button>
          <button type="button" class="btn-custom btn-delete" onclick="deleteRecord()">๐๏ธ ุญุฐู</button>
          <button type="button" class="btn-custom btn-print" onclick="printForm()">๐จ๏ธ ฺุงูพ</button>
          <button type="button" class="btn-custom" style="background: #718096;" onclick="backToSearch()">โฌ๏ธ ุจุฑฺฏุดุช</button>
        </div>
      </form>
    </div>
  </div>

  <div id="toastArea" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055;"></div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const ADMIN_PASSWORD = "222564";
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxmOXK8N_1blZpooY7OEsEwX5vECXCxSNKnoOTrcOOsFdT1Rp5XyLMf2FLn5t-8hiDccQ/exec";
    
    let allStaff = [];
    let filteredStaff = [];
    let currentIndex = -1;

    function showToast(msg, type = 'info') {
      const id = 't' + Date.now();
      const colors = {success: 'bg-success', danger: 'bg-danger', warning: 'bg-warning', info: 'bg-info'};
      const html = `<div id="${id}" class="toast text-white ${colors[type]} border-0" style="min-width: 250px;"><div class="d-flex"><div class="toast-body">${msg}</div></div></div>`;
      document.getElementById('toastArea').insertAdjacentHTML('beforeend', html);
      new bootstrap.Toast(document.getElementById(id), { delay: 3000 }).show();
    }

    function loadAllData() {
      const url = WEBAPP_URL + '?action=getAll&callback=handleLoadAll';
      const script = document.createElement('script');
      window.handleLoadAll = function(data) {
        allStaff = Array.isArray(data) ? data : [];
        if (document.head.contains(script)) document.head.removeChild(script);
        delete window.handleLoadAll;
      };
      script.src = url;
      document.head.appendChild(script);
    }

    function showAdminPanel() {
      hideAllPages();
      document.getElementById('passwordPage').classList.add('active');
    }

    function showTeacherPanel() {
      hideAllPages();
      document.getElementById('teacherFormPage').classList.add('active');
      document.getElementById('teacherForm').reset();
    }

    function hideAllPages() {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    }

    function backToMain() {
      hideAllPages();
      document.getElementById('mainPage').classList.add('active');
      document.getElementById('passwordInput').value = '';
    }

    function backToPasswordPage() {
      hideAllPages();
      document.getElementById('passwordPage').classList.add('active');
    }

    function checkPassword() {
      const pwd = document.getElementById('passwordInput').value;
      if (pwd === ADMIN_PASSWORD) {
        hideAllPages();
        document.getElementById('searchPage').classList.add('active');
        // ุจุงุฑฺฏุฐุงุฑ ุฏุงุฏูโูุง ูุจู ุงุฒ ููุงุด
        setTimeout(() => {
          loadAllData();
    
    // ุจุงุฑฺฏุฐุงุฑ ูุฌุฏุฏ ูุฑ 10 ุซุงูู
    setInterval(() => {
      if (document.getElementById('searchPage').classList.contains('active')) {
        loadAllData();
      }
    }, 10000);
        }, 100);
        document.getElementById('searchInput').value = '';
        document.getElementById('searchResults').style.display = 'none';
        document.getElementById('passwordInput').value = '';
      } else {
        showToast('ุฑูุฒ ุงุดุชุจุงู ุงุณุช', 'danger');
        document.getElementById('passwordInput').value = '';
      }
    }

    document.getElementById('passwordInput').addEventListener('keyup', function(e) {
      if (e.key === 'Enter') checkPassword();
    });

    function performSearch() {
      const q = document.getElementById('searchInput').value.trim().toLowerCase();
      if (!q) {
        showToast('ูุชู ุฌุณุชุฌู ุฑุง ูุงุฑุฏ ฺฉูุฏ', 'warning');
        return;
      }
      
      filteredStaff = allStaff.filter(item => {
        const lastName = String(item.lastName || '').toLowerCase();
        const firstName = String(item.firstName || '').toLowerCase();
        const code = String(item.personnelCode || '').toLowerCase();
        const nationalId = String(item.nationalId || '').toLowerCase();
        return lastName.includes(q) || firstName.includes(q) || code.includes(q) || nationalId.includes(q);
      });
      
      if (filteredStaff.length === 0) {
        showToast('ูุชุฌูโุง ุงูุช ูุดุฏ', 'warning');
        document.getElementById('searchResults').style.display = 'none';
        return;
      }
      
      displaySearchResults();
    }

    function displaySearchResults() {
      const resultsDiv = document.getElementById('searchResults');
      if (filteredStaff.length === 0) {
        resultsDiv.style.display = 'none';
        return;
      }
      resultsDiv.innerHTML = filteredStaff.map((item, idx) => `
        <div class="search-result-item" onclick="selectRecord(${idx})" style="cursor: pointer; padding: 12px; border-bottom: 1px solid #ddd;">
          <strong style="color: #667eea; font-size: 14px;">${item.firstName || ''} ${item.lastName || ''}</strong><br>
          <small style="color: #999; font-size: 12px;">ฺฉุฏ: ${item.personnelCode || item.nationalId || 'โ'}</small>
        </div>
      `).join('');
      resultsDiv.style.display = 'block';
    }

    function selectRecord(idx) {
      currentIndex = idx;
      fillForm(filteredStaff[idx], 'adminForm');
      hideAllPages();
      document.getElementById('adminFormPage').classList.add('active');
      updateCounter();
    }

    function newRecord() {
      currentIndex = -1;
      hideAllPages();
      document.getElementById('adminFormPage').classList.add('active');
      document.getElementById('adminForm').reset();
      updateCounter();
    }

    function backToSearch() {
      hideAllPages();
      document.getElementById('searchPage').classList.add('active');
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResults').style.display = 'none';
    }

    function fillForm(record, formId) {
      const form = document.getElementById(formId);
      Object.entries(record).forEach(([k, v]) => {
        const el = form.querySelector(`[name="${k}"]`);
        if (el) el.value = v || '';
      });
    }

    function collectFormData(formId) {
      const data = {};
      const form = document.getElementById(formId);
      const formData = new FormData(form);
      for (let [key, value] of formData.entries()) {
        data[key] = value;
      }
      return data;
    }

    function updateCounter() {
      const text = currentIndex >= 0 && filteredStaff.length > 0 ? `${currentIndex + 1} ุงุฒ ${filteredStaff.length}` : 'โ';
      document.getElementById('recordCounter').textContent = text;
    }

    function printForm() { 
      const form = document.getElementById(document.getElementById('adminFormPage').classList.contains('active') ? 'adminForm' : 'teacherForm');
      const data = collectFormData(form.id);
      
      let html = `
        <html dir="rtl">
        <head>
          <meta charset="utf-8">
          <style>
            * { margin: 0; padding: 0; font-family: Vazirmatn, Tahoma, Arial; }
            body { font-size: 11px; line-height: 1.4; padding: 10px; }
            .container { border: 2px solid #000; padding: 15px; }
            .print-header {
              text-align: center;
              margin-bottom: 15px;
              padding-bottom: 10px;
              border-bottom: 2px solid #000;
            }
            .print-header h1 {
              font-size: 18px;
              font-weight: bold;
              margin: 0;
            }
            .print-header h2 {
              font-size: 14px;
              margin: 5px 0 0 0;
              color: #333;
            }
            .row { display: grid; grid-template-columns: 1fr 1fr; gap: 0; margin-bottom: 0; }
            .field { border: 1px solid #000; padding: 8px; display: flex; }
            .field-label { font-weight: bold; width: 40%; text-align: right; padding-left: 10px; }
            .field-value { width: 60%; text-align: right; border-left: 1px solid #000; padding-right: 8px; }
            .approval-section {
              margin-top: 20px;
              padding-top: 10px;
              border-top: 1px solid #000;
              text-align: left;
            }
            .approval-line {
              display: flex;
              justify-content: space-between;
              margin-top: 30px;
            }
            .approval-space {
              width: 200px;
              border-bottom: 1px solid #000;
              text-align: center;
              padding-bottom: 5px;
            }
            @media print { body { padding: 0; margin: 0; } }
          </style>
        </head>
        <body>
        <div class="container">
          <div class="print-header">
            <h1>ูุฑู ูุดุฎุตุงุช ฺฉุงุฑฺฉูุงู ูุฏุฑุณู ุดูุฏ ูุงุณุฑ 1</h1>
            <h2>ูุฑู ุงุทูุงุนุงุช ูพุฑุณูู</h2>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ูุงู</div><div class="field-value">${data.firstName || ''}</div></div>
            <div class="field"><div class="field-label">ฺฉุฏ ูพุฑุณูู</div><div class="field-value">${data.personnelCode || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ูุงู ุฎุงููุงุฏฺฏ</div><div class="field-value">${data.lastName || ''}</div></div>
            <div class="field"><div class="field-label">ฺฉุฏ ูู</div><div class="field-value">${data.nationalId || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ูุงู ูพุฏุฑ</div><div class="field-value">${data.fatherName || ''}</div></div>
            <div class="field"><div class="field-label">ุฌูุณุช</div><div class="field-value">${data.gender || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ูุญู ุตุฏูุฑ</div><div class="field-value">${data.issuePlace || ''}</div></div>
            <div class="field"><div class="field-label">ูุญู ุชููุฏ</div><div class="field-value">${data.birthPlace || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ุชุงุฑุฎ ุชููุฏ</div><div class="field-value">${data.birthDate || ''}</div></div>
            <div class="field"><div class="field-label">ูุถุนุช ุชุฃูู</div><div class="field-value">${data.maritalStatus || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ุชุนุฏุงุฏ ูุฑุฒูุฏุงู</div><div class="field-value">${data.childrenCount || ''}</div></div>
            <div class="field"><div class="field-label">ุณูุช</div><div class="field-value">${data.position || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ููุน ุงุณุชุฎุฏุงู</div><div class="field-value">${data.employmentType || ''}</div></div>
            <div class="field"><div class="field-label">ูุฏุฑฺฉ ุชุญุตู</div><div class="field-value">${data.degree || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ุฑุดุชู ุชุญุตู</div><div class="field-value">${data.major || ''}</div></div>
            <div class="field"><div class="field-label">ุณุงุจูู</div><div class="field-value">${data.experienceYears || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ููุน ุงุดุชุบุงู</div><div class="field-value">${data.dutyType || ''}</div></div>
            <div class="field"><div class="field-label">ูพุงู</div><div class="field-value">${data.grade || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ุดูุงุฑู ฺฉูุงุณ</div><div class="field-value">${data.classNumber || ''}</div></div>
            <div class="field"><div class="field-label">ุฑุงุจุท</div><div class="field-value">${data.liaison || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ุดูุงุฑู ุญุณุงุจ</div><div class="field-value">${data.salaryAccount || ''}</div></div>
            <div class="field"><div class="field-label">ููุน ุจูู</div><div class="field-value">${data.insuranceType || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ูุงู ููุณุฑ</div><div class="field-value">${data.spouseName || ''}</div></div>
            <div class="field"><div class="field-label">ุดุบู ููุณุฑ</div><div class="field-value">${data.spouseJob || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ุดูุงุฑู ููุฑุงู</div><div class="field-value">${data.mobile || ''}</div></div>
            <div class="field"><div class="field-label">ุดูุงุฑู ุชููู</div><div class="field-value">${data.phone || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ฺฉุฏ ูพุณุช</div><div class="field-value">${data.postalCode || ''}</div></div>
            <div class="field"><div class="field-label">ูุงู ุชุงุฏฺฉููุฏู</div><div class="field-value">${data.approverName || ''}</div></div>
          </div>
          <div class="row">
            <div class="field"><div class="field-label">ุชุงุฑุฎ ุชุงุฏ</div><div class="field-value">${data.approveDate || ''}</div></div>
            <div class="field"><div class="field-label">ุขุฏุฑุณ</div><div class="field-value">${data.address || ''}</div></div>
          </div>
          
          <div class="approval-section">
            <div class="approval-line">
              <div class="approval-space">ุงูุถุงุก ฺฉุงุฑููุฏ</div>
              <div class="approval-space">ุงูุถุงุก ูุณุฆูู</div>
            </div>
          </div>
        </div>
        </body>
        </html>
      `;
      
      const printWindow = window.open('', '', 'width=800,height=600');
      printWindow.document.write(html);
      printWindow.document.close();
      setTimeout(() => {
        printWindow.print();
      }, 250);
    }

    function submitTeacherForm(e) {
      e.preventDefault();
      const data = collectFormData('teacherForm');
      
      const cb = 'handleCreate' + Date.now();
      const params = new URLSearchParams();
      params.append('action', 'create');
      params.append('callback', cb);
      Object.entries(data).forEach(([k, v]) => params.append(k, v));
      
      const url = WEBAPP_URL + '?' + params;
      const script = document.createElement('script');
      window[cb] = function(json) {
        if (json?.status === 'success') {
          showToast('โ ุซุจุช ุดุฏ', 'success');
          document.getElementById('teacherForm').reset();
          setTimeout(() => backToMain(), 1500);
        } else {
          showToast('โ ุฎุทุง: ' + (json?.message || 'ูุงูุดุฎุต'), 'danger');
        }
        if (document.head.contains(script)) document.head.removeChild(script);
        delete window[cb];
      };
      script.onerror = function() {
        showToast('โ ุซุจุช ุดุฏ (ุจุฏูู ุงุชุตุงู)', 'success');
        setTimeout(() => backToMain(), 1500);
      };
      script.src = url;
      document.head.appendChild(script);
    }

    function submitAdminForm(e) {
      e.preventDefault();
      const data = collectFormData('adminForm');
      const key = data.personnelCode || data.nationalId;
      
      if (!key) {
        showToast('ฺฉุฏ ูพุฑุณูู ุง ฺฉุฏ ูู ูุงุฒู ุงุณุช', 'warning');
        return;
      }
      
      const action = currentIndex === -1 ? 'create' : 'update';
      const cb = 'handleAdmin' + Date.now();
      const params = new URLSearchParams();
      params.append('action', action);
      params.append('callback', cb);
      if (action === 'update') params.append('key', key);
      Object.entries(data).forEach(([k, v]) => params.append(k, v));
      
      const url = WEBAPP_URL + '?' + params;
      const script = document.createElement('script');
      window[cb] = function(json) {
        if (json?.status === 'success') {
          showToast('โ ' + (action === 'create' ? 'ุซุจุช' : 'ูุฑุงุด') + ' ุดุฏ', 'success');
          setTimeout(() => {
            loadAllData();
            backToSearch();
          }, 800);
        } else {
          showToast('โ ุฎุทุง: ' + (json?.message || 'ูุงูุดุฎุต'), 'danger');
        }
        if (document.head.contains(script)) document.head.removeChild(script);
        delete window[cb];
      };
      script.onerror = function() {
        showToast('โ ' + (action === 'create' ? 'ุซุจุช' : 'ูุฑุงุด') + ' ุดุฏ (ุจุฏูู ุงุชุตุงู)', 'success');
        setTimeout(() => {
          loadAllData();
          backToSearch();
        }, 800);
      };
      script.src = url;
      document.head.appendChild(script);
    }

    function editRecord() {
      showToast('ุงุทูุงุนุงุช ุฑุง ุชุบุฑ ุฏูุฏ ู ุฐุฎุฑู ฺฉูุฏ', 'info');
    }

    function deleteRecord() {
      if (currentIndex === -1) {
        showToast('ุงุจุชุฏุง ฺฉ ุฑฺฉูุฑุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ', 'warning');
        return;
      }
      
      if (!confirm('ุงุฒ ุญุฐู ูุทูุฆู ูุณุชุฏุ')) return;
      
      const data = collectFormData('adminForm');
      const key = data.personnelCode || data.nationalId;
      
      const cb = 'handleDelete' + Date.now();
      const params = new URLSearchParams();
      params.append('action', 'delete');
      params.append('key', key);
      params.append('callback', cb);
      
      const url = WEBAPP_URL + '?' + params;
      const script = document.createElement('script');
      window[cb] = function(json) {
        if (json?.status === 'success') {
          showToast('โ ุญุฐู ุดุฏ', 'success');
          setTimeout(() => {
            loadAllData();
            backToSearch();
          }, 800);
        } else {
          showToast('โ ุฎุทุง', 'danger');
        }
        if (document.head.contains(script)) document.head.removeChild(script);
        delete window[cb];
      };
      script.src = url;
      document.head.appendChild(script);
    }

    document.getElementById('searchInput').addEventListener('input', function() {
      const q = this.value.trim().toLowerCase();
      
      if (q.length === 0) {
        document.getElementById('searchResults').style.display = 'none';
        return;
      }
      
      // ุฌุณุชุฌู ุฏุฑ ููู ููุฏูุง
      filteredStaff = allStaff.filter(item => {
        const firstName = String(item.firstName || '').toLowerCase();
        const lastName = String(item.lastName || '').toLowerCase();
        const code = String(item.personnelCode || '').toLowerCase();
        const nationalId = String(item.nationalId || '').toLowerCase();
        
        // ุฌุณุชุฌู ุจุง ุดุงูู ุจูุฏู ูุฑ ุญุฑู
        return firstName.includes(q) || 
               lastName.includes(q) || 
               code.includes(q) || 
               nationalId.includes(q);
      });
      
      console.log('ูุชุงุฌ ุฌุณุชุฌู ุจุฑุง "' + q + '":', filteredStaff.length);
      
      if (filteredStaff.length > 0) {
        displaySearchResults();
      } else {
        document.getElementById('searchResults').style.display = 'none';
      }
    });

    loadAllData();
  </script>
</body>
</html>
